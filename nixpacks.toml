# Nixpacks configuration for Railway
# Tells Nixpacks we need both Python AND Node.js
#
# All services use the same start command (python start.py).
# The SERVICE_TYPE environment variable controls which process runs.

[phases.setup]
nixPkgs = ["python313", "nodejs_20"]

[phases.install]
cmds = [
    "python -m venv --copies /opt/venv",
    ". /opt/venv/bin/activate && pip install -r requirements.txt",
    "cd frontend && npm install"
]

[phases.build]
cmds = ["cd frontend && npm install && npm run build"]

[start]
# start.py checks SERVICE_TYPE env var to determine which process to run
cmd = "python start.py"
