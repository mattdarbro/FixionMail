# FixionMail Railway Configuration
#
# All services use the same start command (python start.py).
# The SERVICE_TYPE environment variable controls which process runs:
#   - SERVICE_TYPE=web       -> Web server (gunicorn/FastAPI)
#   - SERVICE_TYPE=worker    -> RQ worker for story generation
#   - SERVICE_TYPE=scheduler -> Daily story scheduler
#   - SERVICE_TYPE=delivery  -> Email delivery scheduler

[build]
builder = "nixpacks"
# Build both Python dependencies AND React frontend
buildCommand = "pip install -r requirements.txt && cd frontend && npm install && npm run build && cd .."

[deploy]
# start.py checks SERVICE_TYPE env var to determine which process to run
startCommand = "python start.py"
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10
